{
}

# HTTP Listener - Redirect to HTTPS
:80 {
    redir https://{host}{uri}
}

# HTTPS Listener - Catch-all for port 443
:443 {
    # Use internal self-signed certificate with on-demand issuance
    # This allows Caddy to generate certs for the internal Docker IP (172.x.x.x)
    tls {
        issuer internal
        on_demand
    }
    
    encode gzip

    # Proxy API requests to the backend
    handle /api/* {
        reverse_proxy api:3000
    }

    # Serve static files from /srv
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}
