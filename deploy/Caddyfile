{
    email talktorobson@gmail.com
}

# Production domains - Let's Encrypt certificates
www.goexec.de, goexec.de {
    encode gzip

    # Proxy API requests to the backend
    handle /api/* {
        reverse_proxy api:3000
    }

    # Camunda Operate - Process Monitoring UI
    handle_path /camunda/operate/* {
        reverse_proxy operate:8080
    }

    # Camunda Tasklist - Human Task UI
    handle_path /camunda/tasklist/* {
        reverse_proxy tasklist:8080
    }

    # Serve mobile app assets (Expo bundles accessed from /mobile/index.html)
    handle /_expo/* {
        root * /srv/mobile
        try_files {path} =404
        file_server
    }

    # Serve mobile app
    handle_path /mobile/* {
        root * /srv/mobile
        try_files {path} /index.html
        file_server
    }

    # Serve static files from /srv
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}

# IP fallback - Self-signed certificate for direct IP access
135.181.96.93 {
    tls {
        issuer internal
    }
    
    encode gzip

    # Proxy API requests to the backend
    handle /api/* {
        reverse_proxy api:3000
    }

    # Camunda Operate - Process Monitoring UI
    handle_path /camunda/operate/* {
        reverse_proxy operate:8080
    }

    # Camunda Tasklist - Human Task UI
    handle_path /camunda/tasklist/* {
        reverse_proxy tasklist:8080
    }

    # Serve mobile app assets
    handle /_expo/* {
        root * /srv/mobile
        try_files {path} =404
        file_server
    }

    # Serve mobile app
    handle_path /mobile/* {
        root * /srv/mobile
        try_files {path} /index.html
        file_server
    }

    # Serve static files from /srv
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}
